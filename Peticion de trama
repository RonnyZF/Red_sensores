#include "stdafx.h"
#include <iostream>
#include <windows.h>
#include <stdlib.h>
using namespace std;


int main()
{
	char PT [24] = 10;
	char CTS [32] = 0;
	char RTS [32] = 0;
	char ACK_IN [24] = 10;
	char ACK_OUT [24] = 10;
	char TRAMA [32] = 1000; // trama de alarma

	enum state { primera_fase, segunda_fase, escucha, verificacion};
	enum state current_state = primera_fase;

	while (current_state != verificacion)
	{
		switch (current_state)
		{
		case primera_fase:
		{
            Sleep(20);
			if (RTS !=0 or CTS!=0)//verifica si estan activos 
			   Sleep(90);//tiempo de espera 9B
			   PT = 17393; // envio de trama PT
			   current_state = primera_fase;
			{
            else
                return Hibernar;
				cout << "Hibernando \n";

			}
			break;
		}

		case segunda_fase:
		{
			if (RTS != 0)
			{
               CTS = 17393; // envio de trama CTS
               current_state = segundo_estado;
				}
				
			else
			{
				return Hibernar;
				cout << "Hibernando \n";
			}
			break;
		}

		case escucha:

		{

		TRAMA = 0000;
		Sleep(20) //tiempo de espera 2B
        current_state = escucha;

			break;
		}

		case verificacion:

		{
			TRAMA = 1527;
			ACK_OUT = 1232;
			Sleep(20) //tiempo de espera 2B
			if (ACK_IN == ACK_OUT)
			{
				TRAMA = 0000;
				// pasa a hibernaciÃ³n
			}
			else
			{
				current_state = verificacion;
			}


			break;
		}
		}

	}
    return 0;
}

int Hibernar()
{
	cout << "Hibernando\n";
	return 0;
}
